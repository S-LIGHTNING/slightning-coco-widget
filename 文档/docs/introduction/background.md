---
sidebar_position: 2
---

# 产生背景

:::tip 提示
本文档的内容可以帮助你更好的了解 SCW 的来源、所解决的问题和未来可能的发展方向。
:::

:::tip 提示
在本文档中，你可能会对所发生的事情感到陌生，你可能会诧异：“咦，我咋没见过这些现象呢？现在 CoCo 控件开发不是还停留在手搓控件文件的时代吗？你说的这些内容是不是假的啊？”。我想说的是，本文档中的内容，大部分都源于我开发一个控件（[源码云功能](https://s-lightning.github.io/Kitten-Cloud-Function/?latest)）的经验，因为是个人经验，所以很少有人知道。如果你结合这个控件代码的变更来看，本文档中所述的内容确实是实际发生过的。
:::

## 一、从手搓控件文件开始

在早期，自定义控件开发靠的是手搓控件文件。控件文件是一个单一的 JS 脚本文件，里面包含了控件所有的功能。那个时候，控件的功能比较简单，直接编写控件文件非常方便。

这样的作法很快就遇到了问题：
- 不同的控件有一些通用的代码，把这些代码来回复制非常麻烦，也不便于管理；
- 在编写复杂功能时，把代码写到都写到一个文件中非常不方便；
- 对于高度动态的 JS 代码，难以进行静态代码分析，一些简单的错误都要运行代码后才能发现，有些功能更新后相应的用法没有及时更新，导致代码出现各种问题。

## 二、通用模块 + 打包工具 + TypeScript 的时代

通用模块、打包工具和 TypeScript 分别解决了上面的三个问题。

将不同控件的公共部分提取为可复用的依赖性，避免了这些代码的来回复制；打包工具可以把分文件的代码合成为一个文件，使模块化编写 CoCo 控件成为可能；TypeScript 强大的语言功能，不止代码提示和静态检查，使我们能够利用一些工具辅助开发。

这相比手搓控件文件，开发体验已经上升了许多，似乎已经能够满足全部的 CoCo 控件开发需求了。在当时，我也是这么想的。然而，开发同构应用的需求、对 node 模块的使用和 Creation Project 的出现却又带来了新的问题。

## 三、新的问题

### 1.开发同构应用的需求

什么是同构应用？简单来说，就是同开发一个可以跑在不同的平台上的程序。例如开发一段 js 代码可以同时被基于 node.js 开发的 web server 和浏览器使用。

有时候，我们想开发一个 CoCo 控件，它不仅仅是一个 CoCo 控件，同时还可以是一段 node 脚本。也就是说，我们需要编写既能在 CoCo 中运行，又能在 node 中运行的代码。

在编写 CoCo 控件时，我们往往会因为 CoCo 的一些特性写一些针对 CoCo 控件的代码，例如把`WebSocket`写成`this["Web" + "Socket"]`，这样的代码只能在 CoCo 中运行，不能在 node 中运行。也许你注意到把`WebSocket`写成`(new Function("return " + "Web" + "Socket"))()`就能使代码同时在 CoCo 和 node 中运行了。但是，仅仅是为了绕过 CoCo 关键词检查，把代码写成这样，简直是太不优雅了。

### 2.对 node 模块的使用

有些 node 模块会使用一些被 CoCo 禁用的 API，想要使用这些库，还要修改这些库中的代码以绕过限制，这也太麻烦了。

### 1 & 2 总结

总之，我们期待有一种方法，可以让我们在不改变源代码的情况下绕过 CoCo 关键词检查。

### 3.Creation Project 的出现

Creation Project 的出现为自定义控件带来了新的可能。Creation Project 自定义控件拥有非常多功能强大的 API，但是，这些 API 只能在 Creation Project 中使用，在 CoCo 中用不了。有没有一种方法，使得我们能够利用 Creation Project 特性的同时兼容 CoCo？

## 四、SCW 出现啦 🎉

### 1.自动绕过 CoCo 自定义控件检查

SCW 通过 webpack 绕过 CoCo 自定义控件检查，无需修改源代码。

### 2.独立于运行平台的控件 API

SCW 独立于运行平台，既可以在 Creation Project 中使用，利用 Creation Project 新特性，又能兼容 CoCo。

### 3.更多强大功能

SCW 有更易使用的 API，更多高级特性，让你的控件更易于使用。
